(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))u(e);new MutationObserver(e=>{for(const a of e)if(a.type==="childList")for(const d of a.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&u(d)}).observe(document,{childList:!0,subtree:!0});function n(e){const a={};return e.integrity&&(a.integrity=e.integrity),e.referrerPolicy&&(a.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?a.credentials="include":e.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function u(e){if(e.ep)return;e.ep=!0;const a=n(e);fetch(e.href,a)}})();const h=14;function w(t,r,n){return Math.sqrt(r*t*n/h)}function O(t,r,n){return h*Math.pow(n,2)/(r*t)}function L(t,r,n){return h*Math.pow(r,2)/(t*n)}const b={requiredAperature:w,requiredShutterSpeed:O,requiredISO:L},i={video:void 0,luminanceOutput:void 0},l={aperature:[],shutterSpeed:[],iso:[]},o={canvas:void 0,ctx:void 0},s={height:0,width:320,streaming:!1},q=250;document.createElement("canvas");E();async function E(){I(),await x(),M()}function I(){i.video=document.querySelector("video"),i.luminanceOutput=document.querySelector("output"),i.aperature=document.querySelector("#aperature"),i.shutterSpeed=document.querySelector("#shutter-speed"),i.iso=document.querySelector("#iso"),l.aperature=[...i.aperature.options].map(t=>Number(t.value)),l.shutterSpeed=[...i.shutterSpeed.options].map(t=>Number(t.value)),l.iso=[...i.iso.options].map(t=>Number(t.value))}async function x(){let[t,r]=[!1,!1];return new Promise(async(n,u)=>{try{let e={video:!0,audio:!1},a=await navigator.mediaDevices.getUserMedia(e);i.video.srcObject=a,i.video.play(),t=!0,t&&r&&n()}catch(e){console.error(`Trouble getting user media: ${e}`),u(e)}i.video.addEventListener("canplay",()=>{s.streaming||(s.height=i.video.videoHeight/i.video.videoWidth,s.height*=s.width,i.video.setAttribute("width",s.width),i.video.setAttribute("height",s.height),s.streaming=!0,r=!0,t&&r&&n())},!1)})}function f(){var p;o.ctx.drawImage(i.video,0,0,o.canvas.width,o.canvas.height);let t=(p=o.ctx.getImageData(0,0,o.canvas.width,o.canvas.height))==null?void 0:p.data,r=0;for(let c=0;c<t.length;c+=4){let v=t[c]/255,g=t[c+1]/255,S=t[c+2]/255,y=.299*v+.587*g+.114*S;r+=y}let n=r/(o.canvas.width*o.canvas.height);i.luminanceOutput.textContent=n.toFixed(10);let u=n*100,e=i.aperature.value;i.shutterSpeed.value;let a=i.iso.value,d=b.requiredShutterSpeed(a,u,e),m=N(l.shutterSpeed,d);i.shutterSpeed.selectedIndex=m}function M(){o.canvas=document.createElement("canvas"),o.ctx=o.canvas.getContext("2d",{willReadFrequently:!0}),o.canvas.width=i.video.width,o.canvas.height=i.video.height,f(),setInterval(f,q)}function N(t,r){let n=t.reduce((u,e)=>Math.abs(e-r)<Math.abs(u-r)?e:u);return t.indexOf(n)}
